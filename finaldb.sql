--table part 
--table1
--insert2
--select * from each table2
--MARK WITH EXTRA CONSTRAINT
--partb 3


connect system/Johnheinz#1
SET PAGESIZE 1000
SET LINESIZE 500



ALTER TABLE EMPLOYEE
DROP (OutNo);
DROP TABLE FAULTREPORT;
DROP TABLE RAGREEMENT;
DROP TABLE CLIENT;
DROP TABLE VEHICLE;
DROP TABLE OUTLET;
DROP TABLE EMPLOYEE;





CREATE TABLE OUTLET
(OUTNO VARCHAR2(6) CONSTRAINT OUTLET_OUTNO_PK PRIMARY KEY,
 STREET VARCHAR2(25),
 CITY VARCHAR2(25),
 STATE VARCHAR2(30),
 ZIPCODE NUMBER(5),
 PHONE NUMBER(10),
 MANAGERNO VARCHAR2(6) DEFAULT NULL
);

CREATE TABLE EMPLOYEE
(EMPNO VARCHAR2(6) CONSTRAINT EMPLOYEE_EMPNO_PK PRIMARY KEY,
FNAME VARCHAR2(20),
LNAME VARCHAR2(20),
POSITION VARCHAR2(25),
PHONE NUMBER(10),
EMAIL VARCHAR2(30),
DOB DATE,
GENDER CHAR(6) 
-----<EXTRA CONSTANT 1>---------
       CONSTRAINT EMPLOYEE_GENDER_CK CHECK (GENDER IN ('Female','Male','female','male','FEMALE','MALE')),
SALARY NUMBER (9,2),
HIREDATE DATE DEFAULT SYSDATE,
OUTNO VARCHAR2(6),
SUPERVISORNO VARCHAR2(6),
CONSTRAINT EMPLOYEE_OUTNO_FK FOREIGN KEY (OUTNO) REFERENCES OUTLET (OUTNO),
CONSTRAINT EMPLOYEE_SUPERVISORNO_FK FOREIGN KEY (SUPERVISORNO) REFERENCES EMPLOYEE (EMPNO)
);

CREATE TABLE VEHICLE
(LICENSENO VARCHAR2(20) CONSTRAINT VEHICLE_LICENSENO_PK PRIMARY KEY,
MAKE VARCHAR2(30),
MODEL VARCHAR2(30),
COLOR VARCHAR2(30),
YEAR NUMBER CONSTRAINT VEHICLE_YEAR_CK CHECK (2018-YEAR<=10),
NODOORS NUMBER(1),
CAPACITY NUMBER(2),
DAILYRATE NUMBER,
INSPECTIONDATE DATE,
OUTNO VARCHAR2(6), 
CONSTRAINT VEHICLE_OUTNO_FK FOREIGN KEY (OUTNO) REFERENCES OUTLET (OUTNO)
);

CREATE TABLE CLIENT
(CLIENTNO VARCHAR2(8) CONSTRAINT CLIENT_CLIENTNO_PK PRIMARY KEY,
CLIENTNAME VARCHAR2(40),
STREET VARCHAR2(25),
CITY VARCHAR2(25),
STATE VARCHAR2(30),
ZIPCODE NUMBER(5),
WEBADDRESS VARCHAR2(50),
CONTACT_FNAME VARCHAR2(20),
CONTACT_LNAME VARCHAR2(20),
PHONE VARCHAR2(10),
EMAIL VARCHAR2(30)
-----<EXTRA CONSTANT 2>---------
CONSTRAINT EMAIL_CHECK CHECK (EMAIL LIKE '%@%.%')
);

CREATE TABLE RAGREEMENT
(RENTALNO VARCHAR2(8) CONSTRAINT RAGREEMENT_RENTALNO_PK PRIMARY KEY,
STARTDATE DATE,
RETURNDATE DATE,
MILEAGEBEFORE NUMBER(7,1),
MILEAGEAFTER NUMBER(7,1),
INSURANCETYPE VARCHAR2(40),
CLIENTNO VARCHAR2(8),
LICENSENO VARCHAR2(20),
CONSTRAINT RAGREEMENT_CLIENTNO_FK FOREIGN KEY (CLIENTNO) REFERENCES CLIENT (CLIENTNO),
CONSTRAINT RAGREEMENT_LICENSENO_FK FOREIGN KEY (LICENSENO) REFERENCES VEHICLE (LICENSENO),
-----<EXTRA CONSTANT 3>---------
CONSTRAINT MILEAGEAFTER_CHECK CHECK (MILEAGEAFTER > MILEAGEBEFORE)
);

CREATE TABLE FAULTREPORT
(REPORTNUM VARCHAR2(10) CONSTRAINT FAULTREPORT_REPORTNUM_PK PRIMARY KEY,
DATECHECKED DATE,
COMMENTS VARCHAR2(60),
EMPNO VARCHAR2(6),
LICENSENO VARCHAR2(20) CONSTRAINT FAULTREPORT_LICENSENO_NN NOT NULL,
RENTALNO VARCHAR2(8),
CONSTRAINT FAULTREPORT_EMPNO_FK FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE (EMPNO),
CONSTRAINT FAULTREPORT_LICENSENO_FK FOREIGN KEY (LICENSENO) REFERENCES VEHICLE (LICENSENO),
CONSTRAINT FAULTREPORT_RENTALNO_FK FOREIGN KEY (RENTALNO) REFERENCES RAGREEMENT (RENTALNO)
);

ALTER TABLE OUTLET
ADD CONSTRAINT OUTLET_MANAGERNO_FK FOREIGN KEY (MANAGERNO) REFERENCES EMPLOYEE (EMPNO);


INSERT INTO OUTLET VALUES ('OUT001','1290 Melvin St.', 'Pittsburgh', 'PA', '15213', '4127089901', NULL);
INSERT INTO OUTLET VALUES ('OUT002','4716 Ellsworth.St', 'Pittsburgh', 'PA', '15215', '4125098970', NULL);
INSERT INTO OUTLET VALUES ('OUT003','8809 Sady.St', 'Pittsburgh', 'PA', '15213', '4123398730', NULL);
INSERT INTO OUTLET VALUES ('OUT004','0977 Oner.St', 'Houston', 'TX', '77001', '8320006769',NULL );
INSERT INTO OUTLET VALUES ('OUT005','3317 Friendship Ave', 'Pittsburgh', 'PA', '15213', '4124950092',NULL );
INSERT INTO OUTLET VALUES ('OUT006','3120 Clay St', 'Dallas', 'TX', '75201', '2145567879',NULL );
INSERT INTO OUTLET VALUES ('OUT100','Hobart St.','Pittsburgh','Pennsylvania','15217','4127089807',NULL);
INSERT INTO OUTLET VALUES ('OUT101','Philips Ave.','Pittsburgh','Pennsylvania','15217','4127089808',NULL);
---pre ok
INSERT INTO EMPLOYEE VALUES ('EMP000', 'Rose', 'Wang', 'Area Manager', '4123479875', 'rose@rentmycar.com', '09-MAY-1981', 'Female', '96000', '03-JUN-2007', 'OUT001', NULL);
INSERT INTO EMPLOYEE VALUES ('EMP001', 'Xiaodi', 'Tao', 'Manager', '4123477775', 'xiaodi@rentmycar.com', '03-MAY-1991', 'Female', '76000', '03-JUN-2007', 'OUT001', 'EMP000');
INSERT INTO EMPLOYEE VALUES ('EMP002', 'Liming', 'Yang', 'Sales Representative', '2134445654', 'liming@rentmycar.com', '11-OCT-1987', 'Male', '56000', '11-AUG-2008', 'OUT001', 'EMP001');
INSERT INTO EMPLOYEE VALUES ('EMP003', 'Coco', 'Huang', 'Sales Representative', '4123335656', 'coco@rentmycar.com', '09-DEC-1985', 'Female', '56000', '25-SEP-2008', 'OUT001', 'EMP001');
INSERT INTO EMPLOYEE VALUES ('EMP004', 'Bajie', 'Zhu', 'Sales Representative', '7789900808', 'bajie@rentmycar.com', '14-JUL-1982', 'Male', '56000', '02-JUN-2011', 'OUT001', 'EMP001');
INSERT INTO EMPLOYEE VALUES ('EMP005', 'Hashy', 'Wu', 'Manager', '2134567678', 'hash@rentmycar.com', '12-APR-1990', 'Male', '56000', '02-MAR-2001', 'OUT002', 'EMP000');
INSERT INTO EMPLOYEE VALUES ('EMP006', 'Kerr', 'White', 'Mechanic', '9920119090', 'kerr@rentmycar.com', '21-MAY-1975', 'Female', '56000', '05-AUG-2018', 'OUT002', 'EMP005');
INSERT INTO EMPLOYEE VALUES ('EMP007', 'Lily', 'Brown', 'Mechanic', '4124445567', 'lily@rentmycar.com', '17-AUG-1988', 'Female', '56000', '18-JUL-2017', 'OUT002', 'EMP005');
INSERT INTO EMPLOYEE VALUES ('EMP008', 'Tony', 'Luo', 'Mechanic', '7899877878', 'tony@rentmycar.com', '13-FEB-1996', 'Male', '56000', '12-APR-2008', 'OUT001', 'EMP001');
INSERT INTO EMPLOYEE VALUES ('EMP009', 'Sara', 'Kong', 'Sales Representative', '4126756378', 'sarak@rentmycar.com', '02-NOV-1987', 'Female', '56000', '22-NOV-2006', 'OUT002', 'EMP005');
INSERT INTO EMPLOYEE VALUES ('EMP010', 'Joe', 'Lee', 'Mechanic', '8980092312', 'joel@rentmycar.com', '21-JAN-1987', 'Male', '56000', '20-MAY-2002', 'OUT001', 'EMP001');
INSERT INTO EMPLOYEE VALUES ('EMP011', 'Lydia', 'Brown', 'Manager', '6756778789', 'lydia@rentmycar.com', '10-NOV-1990', 'Female', '76000', '20-OCT-2010', 'OUT003', 'EMP000');
INSERT INTO EMPLOYEE VALUES ('EMP012', 'Xiaoming', 'Hua', 'Mechanic', '3224565657', 'xiaoh@rentmycar.com', '10-MAR-1987', 'Male', '65000', '17-APR-2016', 'OUT003', 'EMP011');
INSERT INTO EMPLOYEE VALUES ('EMP013', 'Yangyang', 'Li', 'Manager', '8897898980', 'yangyangl@rentmycar.com', '06-JUN-1980', 'Male', '76000', '01-JUN-2009', 'OUT004', 'EMP000');
INSERT INTO EMPLOYEE VALUES ('EMP014', 'Cindy', 'Chen', 'Manager', '8789908989', 'cindy@rentmycar.com', '10-APR-1990', 'Female', '76000', '28-JUL-2017', 'OUT005', 'EMP000');
INSERT INTO EMPLOYEE VALUES ('EMP015', 'Linda', 'Tan', 'Manager', '6776567878', 'lindat@rentmycar.com', '09-APR-1992', 'Female', '76000', '09-FEB-2018', 'OUT006', 'EMP000');
INSERT INTO EMPLOYEE VALUES ('EMP016', 'Hana', 'Lu', 'Mechanic', '2134345567', 'hanal@rentmycar.com', '10-AUG-1991', 'Female', '60000', '30-OCT-2012', 'OUT004', 'EMP013');
INSERT INTO EMPLOYEE VALUES ('EMP017', 'Emma', 'Zhao', 'Mechanic', '3442342221', 'emmaz@rentmycar.com', '11-FEB-1999', 'Female', '60000', '17-FEB-2018', 'OUT005', 'EMP014');
INSERT INTO EMPLOYEE VALUES ('EMP018', 'Sasa', 'Bai', 'Administrative Assistant', '9890980909', 'sasa@rentmycar.com', '11-JAN-1990', 'Female', '56000', '18-MAR-2018', 'OUT006', 'EMP015');
INSERT INTO EMPLOYEE VALUES ('EMP019', 'Jingjing', 'Bai', 'Sales Representative', '6786775123', 'jingjing@rentmycar.com', '11-SEP-1987', 'Female', '56000', '16-JAN-2018', 'OUT004', 'EMP013');
INSERT INTO EMPLOYEE VALUES ('EMP020', 'Wukong', 'Sun', 'Mechanic', '7867798909', 'wukongs@rentmycar.com', '31-MAR-1986', 'Male', '55000', '11-NOV-2011', 'OUT006', 'EMP015');
INSERT INTO EMPLOYEE VALUES ('EMP100','Jack','Ma','Sales Representative','4127089800','jackma@rentmycar.com','04-DEC-1993','Male','70000','03-MAR-2018','OUT001','EMP001');
INSERT INTO EMPLOYEE VALUES ('EMP101','Elon','Musk','Manager','4127089801','elon@rentmycar.com','29-MAY-1990','Male','9000000','29-NOV-2017','OUT100','EMP000');
INSERT INTO EMPLOYEE VALUES ('EMP103','Warren','Buffet','Manager','4127089803','warren@rentmycar.com','10-AUG-1992','Male','7500000','30-MAR-2018','OUT101','EMP000');
INSERT INTO EMPLOYEE VALUES ('EMP104','Bill','Gates','Mechanic','4127089804','bill@rentmycar.com','28-JAN-1990','Male','75000','20-JUN-2017','OUT100','EMP101');
INSERT INTO EMPLOYEE VALUES ('EMP105','Satya','Nadella','Mechanic','4127089805','satya@rentmycar.com','02-OCT-1989','Male','60000','19-MAY-2017','OUT100','EMP101');
INSERT INTO EMPLOYEE VALUES ('EMP106','Sundar','Pichai','Mechanic','4127089806','sundar@rentmycar.com','15-JUN-1994','Male','85000','02-JAN-2018','OUT101','EMP103');
INSERT INTO EMPLOYEE VALUES ('EMP102','Steve','Jobs','Sales Representative','4127089802','steve@rentmycar.com','01-FEB-1989','Male','80000','12-AUG-2018','OUT101','EMP103');
--PRE OK

UPDATE OUTLET SET MANAGERNO = 'EMP001'WHERE OUTNO='OUT001';
UPDATE OUTLET SET MANAGERNO = 'EMP005'WHERE OUTNO='OUT002';
UPDATE OUTLET SET MANAGERNO = 'EMP011'WHERE OUTNO='OUT003';
UPDATE OUTLET SET MANAGERNO = 'EMP013'WHERE OUTNO='OUT004';
UPDATE OUTLET SET MANAGERNO = 'EMP014'WHERE OUTNO='OUT005';
UPDATE OUTLET SET MANAGERNO = 'EMP015'WHERE OUTNO='OUT006';
UPDATE OUTLET SET MANAGERNO = 'EMP101'WHERE OUTNO='OUT100';
UPDATE OUTLET SET MANAGERNO = 'EMP103'WHERE OUTNO='OUT101';
------pre ok
INSERT INTO VEHICLE VALUES
                    ('PSA999', 'BMW', '5 Series', 'RED','2010',2,2, 88,'01-JAN-2018', 'OUT001');				
INSERT INTO VEHICLE VALUES
                    ('HHH898', 'TESLA', 'Model S', 'WHITE', '2016', 4, 4, 93, '19-FEB-2018', 'OUT002');
INSERT INTO VEHICLE VALUES
                    ('YYY090', 'TESLA', 'Model S', 'GREY', '2018', 4, 6, 88, '11-JUL-2018', 'OUT001');	
INSERT INTO VEHICLE VALUES
                    ('WWE222', 'TOYOTA', 'CAMRY', 'BLACK', '2009', 4, 4, 73, '17-AUG-2018', 'OUT002');
INSERT INTO VEHICLE VALUES
                    ('CCC333', 'NISSAN', 'ALTIMA', 'YELLOW', '2009', 2, 2, 103, '11-MAY-2018', 'OUT004');
INSERT INTO VEHICLE VALUES
                    ('FJJ222', 'BMW', '5 Series', 'BLUE', '2018', 4, 4, 63, '11-OCT-2018', 'OUT003');
INSERT INTO VEHICLE VALUES
                    ('EFE333', 'JEEP', 'Model 3', 'RED', '2009', 4, 5, 88, '11-MAR-2018', 'OUT005');
INSERT INTO VEHICLE VALUES
                    ('KKK333', 'GMC', 'Model KE', 'WHITE', '2018', 6, 6, 73, '10-JAN-2018', 'OUT005');
INSERT INTO VEHICLE VALUES
                    ('LJM343', 'BMW', '5 Series', 'WHITE', '2010', 4, 4, 63, '11-FEB-2018', 'OUT003');
INSERT INTO VEHICLE VALUES
                    ('KOI222', 'TOYOTA', 'COROLLA', 'GOLD', '2018', 4, 4, 73, '10-JUN-2018', 'OUT006');
INSERT INTO VEHICLE VALUES
                    ('PLO098', 'NISSAN', 'ALTIMA', 'GREY', '2018', 4, 4, 73, '30-APR-2018', 'OUT005');
INSERT INTO VEHICLE VALUES
                    ('OKP090', 'NISSAN', 'ALTIMA', 'BLACK', '2008', 6, 4, 103, '10-AUG-2018', 'OUT004');
INSERT INTO VEHICLE VALUES
                    ('SGB789', 'NISSAN', 'ALTIMA', 'SILVER', '2010', 4, 4, 83, '10-SEP-2018', 'OUT006');		
INSERT INTO VEHICLE VALUES
                    ('SALK90', 'TOYOTA', 'RAV4', 'BLUE', '2010', 4, 4, 93, '11-OCT-2018', 'OUT006');				
INSERT INTO VEHICLE VALUES
                    ('ADSL89', 'NISSAN', 'ALTIMA', 'SILVER', '2010', 2, 2, 113, '12-OCT-2018', 'OUT003');
INSERT INTO VEHICLE VALUES
                    ('AAA111','Mercedes','C Class','Black','2018',4,5,205,'20-JAN-2018','OUT100');
INSERT INTO VEHICLE VALUES
					('CBC234','Mercedes','S Class','Grey','2018',4,5,200,'30-JAN-2018','OUT100');
INSERT INTO VEHICLE VALUES
					('HBH007','Lamborgini','Avendator','White','2018',2,2,198,'30-MAR-2018','OUT100');
INSERT INTO VEHICLE VALUES
					('YYY067','Honda','Civic Coupe','Silver','2018',2,4,202,'20-FEB-2018','OUT101');
INSERT INTO VEHICLE VALUES
					('KKK555','Cadillac','XTS','Green','2017',4,5,190,'29-FEB-2016','OUT101');
INSERT INTO VEHICLE VALUES
					('LLT666','BMW','7 Series','Blue','2017',4,5,185,'31-JUL-2017','OUT101');
					

----pre ok
INSERT INTO CLIENT VALUES
                   ('CLIENT01', 'WAYFAIR', '201 FORBE St','Pittsburgh','PA','15213','www.wayfair.com','JOE','LEE','4234565565','joel@gmail.com');
INSERT INTO CLIENT VALUES
                   ('CLIENT02', 'WAYFAIR', '220 FRIENDSHIP Ave','Pittsburgh','PA','15213','www.wayfair.com','LISA','KONG','4124453432','435664432@gmail.com');				   
INSERT INTO CLIENT VALUES
                   ('CLIENT03', 'AKUNA', '998 LUIS St','Pittsburgh','PA','15213','www.akuna.com','KATTY','ZHANG','4123343234','katty09@gmail.com');				 
INSERT INTO CLIENT VALUES
                   ('CLIENT04', 'AKUNA', '343 CANDY','Pittsburgh','PA','15213','www.akuna.com','JOHN','WHITE','5456776787','jo8897@gmail.com');				   
INSERT INTO CLIENT VALUES
                   ('CLIENT05', 'AKUNA', '102 FAN Ave','Pittsburgh','PA','15215','www.akuna.com','MARRY','SMITH','5595565456','masc8098@gmail.com');
INSERT INTO CLIENT VALUES
                   ('CLIENT06', 'CIOT', '567 MIRR St','Pittsburgh','PA','15215','www.ciot.com','KLAUSE','LU','4567678878','svs3323@gmail.com');
INSERT INTO CLIENT VALUES
                   ('CLIENT07', 'CIOT', '321 SAND St','Pittsburgh','PA','15215','www.ciot.com','LYNN','TA','4123234434','lynn1889@gmail.com');
INSERT INTO CLIENT VALUES
                   ('CLIENT08', 'C3IOT', '132 BURGH St','Pittsburgh','PA','15215','www.c3iot.com','YAMMY','LEE','4534456767','yammy@hotmail.com');
INSERT INTO CLIENT VALUES
                   ('CLIENT09', 'TRADER JOES', '789 ORANGE St','Pittsburgh','PA','15215','www.traderj.com','ANN','HUA','6758890978','ann01@gmail.com');
INSERT INTO CLIENT VALUES
				   ('CLIENT10','Narendra Modi','Rashtrapati Bhavan','Delhi','Delhi','40001','www.narendramodi.com','Amit','Shah','4127089809','amitshah@gmail.com');
INSERT INTO CLIENT VALUES
				   ('CLIENT11','Mukesh Ambani','Antilla','Mumbai','Maharashtra','40067','www.reliance.com','Nita','Ambani','4127089810','nitaambani@gmail.com');
INSERT INTO CLIENT VALUES
				   ('CLIENT12','Larry Page','Palo Alto','California','California','94043','www.google.com','John','Appleseed','4127089811','john@appleseed.com');
INSERT INTO CLIENT VALUES
				   ('CLIENT13','Sergey Brin','Palo Alto','California','California','94043','www.google.com','John','Doe','4127089812','jogndoe@gmail.com');
INSERT INTO CLIENT VALUES
			       ('CLIENT14','Mark Zuckerburg','Menlo Park','California','California','94025','www.facebook.com','Randy','Zuckerburg','4127089813','randy@facebook.com');

--pre ok
				   


INSERT INTO RAGREEMENT VALUES
                         ('RAGRE01',TO_DATE('13-FEB-2017 09:30' ,'DD-MON-YYYY HH:MI'),TO_DATE('16-FEB-2017 10:30','DD-MON-YYYY HH:MI') ,'188','200','Comprehensive Coverage','CLIENT01','PSA999');
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE02',TO_DATE('12-JUN-2017 12:30','DD-MON-YYYY HH:MI'),TO_DATE('14-AUG-2017 10:30','DD-MON-YYYY HH:MI'),'368','609','Comprehensive Coverage','CLIENT02','HHH898');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE03',TO_DATE('12-JAN-2015 09:30','DD-MON-YYYY HH:MI'),TO_DATE('15-JAN-2015 10:30','DD-MON-YYYY HH:MI'),'878','1099','Collision Coverage','CLIENT03','YYY090');			 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE04',TO_DATE('10-FEB-2017 09:30','DD-MON-YYYY HH:MI'),TO_DATE('20-FEB-2017 10:30','DD-MON-YYYY HH:MI'),'288','290','Personal Injury','CLIENT04','WWE222');				 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE05',TO_DATE('11-FEB-2018 05:30','DD-MON-YYYY HH:MI'),TO_DATE('22-MAY-2018 10:30','DD-MON-YYYY HH:MI'),'699','899','Personal Injury','CLIENT05','CCC333');				 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE06',TO_DATE('22-MAY-2017 09:30','DD-MON-YYYY HH:MI'),TO_DATE('22-AUG-2017 10:30','DD-MON-YYYY HH:MI'),'199','245','Comprehensive Coverage','CLIENT06','FJJ222');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE07',TO_DATE('11-SEP-2018 05:30','DD-MON-YYYY HH:MI'),TO_DATE('11-SEP-2018 10:30','DD-MON-YYYY HH:MI'),'199','209','Personal Injury','CLIENT07','EFE333');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE08',TO_DATE('22-MAY-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('28-MAY-2018 10:30','DD-MON-YYYY HH:MI'),'324','333','Collision Coverage','CLIENT08','KKK333');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE09',TO_DATE('10-JAN-2017 09:30','DD-MON-YYYY HH:MI'),TO_DATE('12-FEB-2017 10:30','DD-MON-YYYY HH:MI'),'297','309','Comprehensive Coverage','CLIENT09','LJM343');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE10',TO_DATE('13-SEP-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('15-SEP-2018 10:30','DD-MON-YYYY HH:MI'),'797','890','Collision Coverage','CLIENT10','KOI222');
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE11',TO_DATE('12-SEP-2017 05:30','DD-MON-YYYY HH:MI'),TO_DATE('12-OCT-2017 10:30','DD-MON-YYYY HH:MI'),'899','1090','Comprehensive Coverage','CLIENT11','PLO098');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE12',TO_DATE('23-JAN-2017 06:30','DD-MON-YYYY HH:MI'),TO_DATE('27-JAN-2017 10:30','DD-MON-YYYY HH:MI'),'379','408','Collision Coverage','CLIENT11','OKP090');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE13',TO_DATE('16-JUL-2018 02:30','DD-MON-YYYY HH:MI'),TO_DATE('16-JUL-2018 10:30','DD-MON-YYYY HH:MI'),'199','205','Personal Injury','CLIENT11','SGB789');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE14',TO_DATE('21-SEP-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('23-SEP-2018 10:30','DD-MON-YYYY HH:MI'),'794','901','Comprehensive Coverage','CLIENT10','SALK90');						 
INSERT INTO RAGREEMENT VALUES
                         ('RAGRE15',TO_DATE('10-FEB-2017 09:30','DD-MON-YYYY HH:MI'),TO_DATE('10-FEB-2017 10:30','DD-MON-YYYY HH:MI'),'897','902','Comprehensive Coverage','CLIENT10','ADSL89');
INSERT INTO RAGREEMENT VALUES
						('RA000100',TO_DATE('02-JAN-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('09-JAN-2018 12:30','DD-MON-YYYY HH:MI'),'102','809','Personal Injury','CLIENT10','AAA111');
INSERT INTO RAGREEMENT VALUES
						('RA000101',TO_DATE('03-FEB-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('04-FEB-2018 12:30','DD-MON-YYYY HH:MI'),'304','456','Personal Injury','CLIENT11','CBC234');
INSERT INTO RAGREEMENT VALUES
						('RA000102',TO_DATE('05-MAR-2018 03:30','DD-MON-YYYY HH:MI'),TO_DATE('15-MAR-2018 12:30','DD-MON-YYYY HH:MI'),'5000','5608','Personal Injury','CLIENT12','HBH007');
INSERT INTO RAGREEMENT VALUES
						('RA000103',TO_DATE('06-APR-2018 03:30','DD-MON-YYYY HH:MI'),TO_DATE('09-MAY-2018 12:30','DD-MON-YYYY HH:MI'),'3679','4567','Personal Injury','CLIENT13','YYY067');
INSERT INTO RAGREEMENT VALUES
						('RA000104',TO_DATE('08-JUN-2018 03:30','DD-MON-YYYY HH:MI'),TO_DATE('09-JUN-2018 12:30','DD-MON-YYYY HH:MI'),'7896','8075','Personal Injury','CLIENT14','KKK555');
INSERT INTO RAGREEMENT VALUES
						('RA000105',TO_DATE('07-MAY-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('06-JUN-2018 12:30','DD-MON-YYYY HH:MI'),'5467','5703','Comprehensive Coverage','CLIENT10','LLT666');
INSERT INTO RAGREEMENT VALUES
						('RA000106',TO_DATE('09-JUL-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('20-JUL-2018 12:30','DD-MON-YYYY HH:MI'),'4087','4387','Comprehensive Coverage','CLIENT11','AAA111');
INSERT INTO RAGREEMENT VALUES
						('RA000107',TO_DATE('10-AUG-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('20-AUG-2018 12:30','DD-MON-YYYY HH:MI'),'10286','10546','Comprehensive Coverage','CLIENT10','CBC234');
INSERT INTO RAGREEMENT VALUES
						('RA000108',TO_DATE('11-SEP-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('02-OCT-2018 12:30','DD-MON-YYYY HH:MI'),'567','785','Comprehensive Coverage','CLIENT14','HBH007');
INSERT INTO RAGREEMENT VALUES
						('RA000109',TO_DATE('12-OCT-2018 09:30','DD-MON-YYYY HH:MI'),TO_DATE('22-OCT-2018 12:30','DD-MON-YYYY HH:MI'),'983','1084','Comprehensive Coverage','CLIENT13','YYY067');
INSERT INTO RAgreement VALUES 
						('RA000110',TO_DATE('07-NOV-2018 12:30','DD-MON-YYYY HH:MI'),TO_DATE('08-NOV-2018 12:30','DD-MON-YYYY HH:MI'),'5703','5773','Comprehensive Coverage','CLIENT01','LLT666');
INSERT INTO RAgreement VALUES
						('RA000111',TO_DATE('19-NOV-2018 12:30','DD-MON-YYYY HH:MI'),TO_DATE('22-NOV-2018 12:30','DD-MON-YYYY HH:MI'),'1132','1186','Comprehensive Coverage','CLIENT02','AAA111');
INSERT INTO RAgreement VALUES
						('RA000112',TO_DATE('16-NOV-2018 12:30','DD-MON-YYYY HH:MI'),TO_DATE('28-NOV-2018 12:30','DD-MON-YYYY HH:MI'),'546','1453','Comprehensive Coverage','CLIENT03','CBC234');


						 

						 
						 

INSERT INTO FAULTREPORT VALUES ('FAULT01',  TO_DATE('17-FEB-2017 10:00', 'DD-MON-YYYY HH:MI'),'Left hand door slightly scratched', 'EMP006', 'PSA999', 'RAGRE01');
INSERT INTO FAULTREPORT VALUES ('FAULT02',  TO_DATE('15-AUG-2017 11:00', 'DD-MON-YYYY HH:MI'),'Left hand door slightly scratched', 'EMP010', 'HHH898', 'RAGRE02');
INSERT INTO FAULTREPORT VALUES ('FAULT03',  TO_DATE('16-JAN-2015 11:00', 'DD-MON-YYYY HH:MI'),'Flat tire on back passenger side.', 'EMP017', 'YYY090', 'RAGRE03');
INSERT INTO FAULTREPORT VALUES ('FAULT04',  TO_DATE('21-FEB-2017 11:00', 'DD-MON-YYYY HH:MI'),'Left hand door slightly scratched','EMP010' ,'WWE222','RAGRE04');
INSERT INTO FAULTREPORT VALUES ('FAULT05',  TO_DATE('23-MAY-2018 12:00', 'DD-MON-YYYY HH:MI'),'The headlights are broken', 'EMP010', 'CCC333', 'RAGRE05');
INSERT INTO FAULTREPORT VALUES ('FAULT06',  TO_DATE('23-OCT-2017 11:00', 'DD-MON-YYYY HH:MI'),'The headlights are broken', 'EMP012', 'FJJ222', 'RAGRE06');
INSERT INTO FAULTREPORT VALUES ('FAULT07',  TO_DATE('12-SEP-2018 12:00', 'DD-MON-YYYY HH:MI'),'Left hand door slightly scratched', 'EMP016', 'EFE333', 'RAGRE07');
INSERT INTO FAULTREPORT VALUES ('FAULT08',  TO_DATE('29-MAY-2018 11:00', 'DD-MON-YYYY HH:MI'),'The headlights are broken', 'EMP017', 'KKK333', 'RAGRE08');
INSERT INTO FAULTREPORT VALUES ('FAULT09',  TO_DATE('13-SEP-2017 11:00', 'DD-MON-YYYY HH:MI'),'Left hand door slightly scratched', 'EMP020', 'LJM343', 'RAGRE09');
INSERT INTO FAULTREPORT VALUES ('FAULT10',  TO_DATE('14-OCT-2018 11:00', 'DD-MON-YYYY HH:MI'), 'The headlights are broken', 'EMP016', 'KOI222', 'RAGRE10');
INSERT INTO FAULTREPORT VALUES ('FAULT11',  TO_DATE('13-MAR-2017 12:00', 'DD-MON-YYYY HH:MI'),'The right front door peeled off a layer of paint', 'EMP017', 'PLO098', 'RAGRE11');
INSERT INTO FAULTREPORT VALUES ('FAULT12',  TO_DATE('28-JAN-2017 11:00', 'DD-MON-YYYY HH:MI'),'The right front door peeled off a layer of paint', 'EMP020', 'OKP090', 'RAGRE12');
INSERT INTO FAULTREPORT VALUES ('FAULT13',  TO_DATE('17-JUL-2016 12:00', 'DD-MON-YYYY HH:MI'),'The right front door peeled off a layer of paint', 'EMP020', 'SGB789', 'RAGRE13');
INSERT INTO FAULTREPORT VALUES ('FAULT14',  TO_DATE('24-SEP-2018 11:00', 'DD-MON-YYYY HH:MI'),'All going well', 'EMP006', 'SALK90', 'RAGRE14');
INSERT INTO FAULTREPORT VALUES ('FAULT100', TO_DATE('10-JAN-2018 10:00', 'DD-MON-YYYY HH:MI'),'Right Door Scratches','EMP104','AAA111','RA000100');
INSERT INTO FAULTREPORT VALUES ('FAULT101', TO_DATE('17-MAR-2018 10:00', 'DD-MON-YYYY HH:MI'),'Bumper Dented','EMP105','CBC234','RA000101');
INSERT INTO FAULTREPORT VALUES ('FAULT102', TO_DATE('12-JUN-2018 10:00', 'DD-MON-YYYY HH:MI'),'Seat Cover Torn','EMP106','KKK555','RA000104');
INSERT INTO FAULTREPORT VALUES ('FAULT103', TO_DATE('21-JUL-2018 10:00', 'DD-MON-YYYY HH:MI'),'Right Tail Light Broken','EMP105','AAA111','RA000106');
INSERT INTO FAULTREPORT VALUES ('FAULT104', TO_DATE('20-AUG-2018 10:00', 'DD-MON-YYYY HH:MI'),'Side Glass Broken','EMP104','CBC234','RA000107');
INSERT INTO FaultReport VALUES ('FAULT105', TO_DATE('13-OCT-2018 11:00', 'DD-MON-YYYY HH:MI'),'Seat Cover Torn','EMP106','YYY067','RA000109');
INSERT INTO FaultReport VALUES ('FAULT106', TO_DATE('23-NOV-2018 11:00', 'DD-MON-YYYY HH:MI'),'Right Tail Light Broken','EMP105','AAA111','RA000111');
INSERT INTO FaultReport VALUES ('FAULT107', TO_DATE('30-NOV-2018 11:00', 'DD-MON-YYYY HH:MI'),'Side Glass Broken','EMP104','CBC234','RA000112');

---1-------------------------------------------
SET LINESIZE 10000
COLUMN START_DATE FORMAT A20
COLUMN RETURN_DATE FORMAT A20
COLUMN RETURN_DATE FORMAT A20
COLUMN MAKE FORMAT A12
COLUMN MODEL FORMAT A12
SELECT DISTINCT RAGREEMENT.RENTALNO,TO_CHAR(STARTDATE,'DD-MON-YYYY HH:MI') AS START_DATE,
       TO_CHAR(RETURNDATE,'DD-MON-YYYY HH:MI') AS RETURN_DATE,MILEAGEBEFORE,
       MILEAGEAFTER,LICENSENO,OUTNO,MAKE,MODEL,YEAR,NVL(TO_CHAR(DATECHECKED),'NO FAULT REPORT') AS DATECHEKED
FROM   RAGREEMENT JOIN VEHICLE USING (LICENSENO)
                   LEFT JOIN FAULTREPORT USING (LICENSENO);

SELECT NAME 
FROM   PERSON JOIN ORDER USING (P_ID)
WHERE  O_DATE = '2017/07/01';
				   

--2FINAL--
COLUMN OUTLET_NUMBER FORMAT A20
SELECT DECODE(OUTNO, NULL, 'GRAND TOTAL', OUTNO)                          AS "Outlet_Number",
       COUNT(DISTINCT LICENSENO)                                          AS "Number of Vehicles",
       COUNT(DISTINCT RENTALNO)                                           AS "Number of Agreements",
       ROUND(NVL(AVG(MILEAGEAFTER - MILEAGEBEFORE), 0),1)                 AS "Average Mileage",
       COUNT(DISTINCT EMPNO)                                              AS "Number of Employees",
	   ROUND(NVL((COUNT(DISTINCT RENTALNO))/(COUNT(DISTINCT EMPNO)),0),1)   AS "Number of Rental per Employee"
FROM   OUTLET   LEFT JOIN EMPLOYEE   ON (EMPLOYEE.OUTNO = OUTLET.OUTNO)
                LEFT JOIN VEHICLE    ON (VEHICLE.OUTNO = OUTLET.OUTNO)
                LEFT JOIN 
                         (
                          SELECT * 
                          FROM RAGREEMENT 
                          WHERE EXTRACT(YEAR FROM STARTDATE) = 2017
                         ) 
                          USING (LICENSENO)
GROUP  BY ROLLUP(OUTNO)
ORDER  BY OUTNO;

				   
---3------------------------------------------
SET LINESIZE 10000
COLUMN MON FORMAT A12
COLUMN MON_OF_YEAR FORMAT A12
SELECT MON, MON_OF_YEAR,NVL(OUT001,0) OUTLET1,NVL(OUT002,0) OUTLET2,NVL(OUT003,0) OUTLET3,NVL(OUT004,0) OUTLET4,NVL(OUT005,0) OUTLET5,NVL(OUT006,0) OUTLET6,
NVL(OVERREV,0) OVERRALRENV, NVL(NUMOFRENTALS,0) NUMOFRENTALS, NVL(REV_PER_RENTAL,0) REV_PER_RENTAL
FROM (
(SELECT DECODE (TO_CHAR(RETURNDATE,'MM'),NULL,'MONTH_TOTAL',TO_CHAR(RETURNDATE,'MM')) AS "MON",
	CEIL(SUM ((DECODE(OUTNO,'OUT001',DAILYRATE*(RETURNDATE-STARTDATE),0)))) AS "OUT001",
	CEIL(SUM ((DECODE(OUTNO,'OUT002',DAILYRATE*(RETURNDATE-STARTDATE),0)))) AS "OUT002",
	CEIL(SUM ((DECODE(OUTNO,'OUT003',DAILYRATE*(RETURNDATE-STARTDATE),0)))) AS "OUT003",
	CEIL(SUM ((DECODE(OUTNO,'OUT004',DAILYRATE*(RETURNDATE-STARTDATE),0)))) AS "OUT004",
	CEIL(SUM ((DECODE(OUTNO,'OUT005',DAILYRATE*(RETURNDATE-STARTDATE),0)))) AS "OUT005",
	CEIL(SUM ((DECODE(OUTNO,'OUT006',DAILYRATE*(RETURNDATE-STARTDATE),0)))) AS "OUT006",
	CEIL(SUM ((RETURNDATE-STARTDATE)*DAILYRATE)) AS "OVERREV",
	CEIL(SUM((RETURNDATE-STARTDATE)*DAILYRATE)/COUNT(RENTALNO)) AS "REV_PER_RENTAL",
	COUNT(RENTALNO) AS "NUMOFRENTALS"	
FROM RAGREEMENT JOIN VEHICLE USING (LICENSENO)
WHERE RETURNDATE BETWEEN '01-JAN-2017' AND '31-DEC-2017'
GROUP BY GROUPING SETS(TO_CHAR(RETURNDATE,'MM'),()))
FULL JOIN (SELECT TO_CHAR(ADD_MONTHS(DATE '2018-01-15',LEVEL-1),'MM')  MON, TO_CHAR(ADD_MONTHS(DATE '2018-01-15',LEVEL-1),'Month')  MON_of_Year
	FROM dual
	CONNECT BY level<=MONTHS_BETWEEN(TRUNC(DATE'2018-12-01','MM'),TRUNC (DATE '2018-01-01'))+1) USING (MON))
ORDER BY MON;

--4FINAL--
SELECT NVL(TABLE1.OUTNO, TABLE2.OUTNO)                            AS "Outlet",
       NVL("RMonday", 0)    AS "RMonday",    NVL("FMonday", 0)    AS "FMonday", 
       NVL("RTuesday", 0)   AS "RTuesday",   NVL("FTuesday", 0)   AS "FTuesday", 
       NVL("RWednesday", 0) AS "RWednesday", NVL("FWednesday", 0) AS "FWednesday",
       NVL("RThursday", 0)  AS "RThursday",  NVL("FThursday", 0)  AS "FThursday",
       NVL("RFriday", 0)    AS "RFriday",    NVL("FFriday", 0)    AS "FFriday",
       NVL("RSaturday", 0)  AS "RSaturday",  NVL("FSaturday", 0)  AS "FSaturday",
       NVL("RSunday", 0)    AS "RSunday",    NVL("FSunday", 0)    AS "FSunday",
       NVL("RTotal", 0)     AS "RTotal",     NVL("FTotal", 0)     AS "FTotal"
FROM
       (
        SELECT DECODE(OUTLET.OUTNO, NULL, 'TOTAL', OUTLET.OUTNO) "OUTNO",
              SUM ( CASE WHEN TO_CHAR(STARTDATE, 'D') = 2 THEN 1 ELSE 0 END ) AS "RMonday",
	
              SUM ( CASE WHEN TO_CHAR(STARTDATE, 'D') = 3 THEN 1 ELSE 0 END ) AS "RTuesday",
	
              SUM ( CASE WHEN TO_CHAR(STARTDATE, 'D') = 4 THEN 1 ELSE 0 END ) AS "RWednesday",
	
              SUM ( CASE WHEN TO_CHAR(STARTDATE, 'D') = 5 THEN 1 ELSE 0 END ) AS "RThursday",
	
              SUM ( CASE WHEN TO_CHAR(STARTDATE, 'D') = 6 THEN 1 ELSE 0 END ) AS "RFriday",
	
              SUM ( CASE WHEN TO_CHAR(STARTDATE, 'D') = 7 THEN 1 ELSE 0 END ) AS "RSaturday",
	
              SUM ( CASE WHEN TO_CHAR(STARTDATE, 'D') = 1 THEN 1 ELSE 0 END ) AS "RSunday",
	
              COUNT(RENTALNO)
                                                 AS "RTotal"
        FROM RAGREEMENT JOIN VEHICLE ON (RAGREEMENT.LICENSENO = VEHICLE.LicenseNo)
                       JOIN OUTLET ON (OUTLET.OUTNO = VEHICLE.OUTNO)
        WHERE STARTDATE > (SYSDATE - 183)
        GROUP BY GROUPING SETS(OUTLET.OUTNO, ())
       ) TABLE1
FULL OUTER JOIN
       (
        SELECT DECODE(OUTLET.OUTNO, NULL, 'TOTAL', OUTLET.OUTNO) "OUTNO",
	      SUM ( CASE WHEN TO_CHAR(DATECHECKED, 'D') = 2 THEN 1 ELSE 0 END ) AS "FMonday",
	
	      SUM ( CASE WHEN TO_CHAR(DATECHECKED, 'D') = 3 THEN 1 ELSE 0 END ) AS "FTuesday",
	
	      SUM ( CASE WHEN TO_CHAR(DATECHECKED, 'D') = 4 THEN 1 ELSE 0 END ) AS "FWednesday",
	
	      SUM ( CASE WHEN TO_CHAR(DATECHECKED, 'D') = 5 THEN 1 ELSE 0 END ) AS "FThursday",
	
	      SUM ( CASE WHEN TO_CHAR(DATECHECKED, 'D') = 6 THEN 1 ELSE 0 END ) AS "FFriday",
	
	      SUM ( CASE WHEN TO_CHAR(DATECHECKED, 'D') = 7 THEN 1 ELSE 0 END ) AS "FSaturday",
	
	      SUM ( CASE WHEN TO_CHAR(DATECHECKED, 'D') = 1 THEN 1 ELSE 0 END ) AS "FSunday",
	
	      COUNT(REPORTNUM)
                                                  AS "FTotal"
	FROM FAULTREPORT JOIN EMPLOYEE ON (FAULTREPORT.EMPNO = EMPLOYEE.EMPNO)
			 JOIN OUTLET ON (OUTLET.OUTNO = EMPLOYEE.OUTNO)
        WHERE DATECHECKED > (SYSDATE - 183)
        GROUP BY GROUPING SETS(OUTLET.OUTNO, ())
       ) TABLE2
ON TABLE2.OUTNO = TABLE1.OUTNO;

----5-----------------------------------
-----tiankong
SELECT OUTNO,MANAGERNO,FNAME,LNAME,COUNT(RENTALNO) AS RENTAL_NUMBER, 
       ROUND((SUM(DailyRate*(ROUND(RETURNDATE-STARTDATE)))/COUNT(RENTALNO)),2) AS REVENUE_PER_RENTAL,
	   ROUND((COUNT(REPORTNUM)/COUNT(RENTALNO)),2)	AS NUM_FAULT_PER_RENTAL			
FROM OUTLET JOIN EMPLOYEE ON EMPLOYEE.EMPNO=OUTLET.MANAGERNO
			JOIN VEHICLE ON OUTLET.OUTNO=VEHICLE.OUTNO
            LEFT JOIN RAGREEMENT ON RAGREEMENT.LICENSENO=VEHICLE.LICENSENO
			LEFT JOIN FAULTREPORT USING (RENTALNO)
GROUP BY GROUPING SETS((OUTNO,FNAME, LNAME,MANAGERNO), (MANAGERNO,FNAME,LNAME));

--6FINAL--
----format
SELECT NVL(NULL, 'Maximum')                      AS "Minimum / Maximum", 
       OUTLET.OUTNO || ' - ' || OUTLET.STREET      AS "Outlet",
       SUM((RETURNDATE - STARTDATE) * DAILYRATE) AS "Amount"
FROM RAGREEMENT JOIN VEHICLE ON (RAGREEMENT.LICENSENO = VEHICLE.LICENSENO)
                JOIN OUTLET  ON (OUTLET.OUTNO = VEHICLE.OUTNO) 
WHERE (RETURNDATE >= '01-OCT-2017' AND RETURNDATE <= '31-MAR-2018')
GROUP BY OUTLET.OUTNO, OUTLET.STREET
HAVING SUM((RETURNDATE - STARTDATE) * DAILYRATE) = 
      (
       SELECT MAX(SUM((RETURNDATE - STARTDATE) * DAILYRATE)) AS "Amount"
       FROM RAGREEMENT JOIN VEHICLE ON (RAGREEMENT.LICENSENO = VEHICLE.LICENSENO)
                       JOIN OUTLET  ON (OUTLET.OUTNO = VEHICLE.OUTNO) 
       WHERE (RETURNDATE >= '01-OCT-2017' AND RETURNDATE <= '31-MAR-2018')
       GROUP BY OUTLET.OUTNO
      )
UNION ALL
SELECT NVL(NULL, 'Minimum')                      AS "Minimum / Maximum", 
       OUTLET.OUTNO || ' - ' || OUTLET.STREET      AS "Outlet", 
       SUM((RETURNDATE - STARTDATE) * DAILYRATE) AS "Amount"
FROM RAGREEMENT JOIN VEHICLE ON (RAGREEMENT.LICENSENO = VEHICLE.LICENSENO)
                JOIN OUTLET  ON (OUTLET.OUTNO = VEHICLE.OUTNO) 
WHERE (RETURNDATE >= '01-OCT-2017' AND RETURNDATE <= '31-MAR-2018')
GROUP BY OUTLET.OUTNO, OUTLET.STREET
HAVING SUM((RETURNDATE - STARTDATE) * DAILYRATE) = 
      (
       SELECT MIN(SUM((RETURNDATE - STARTDATE) * DAILYRATE)) AS VALUE
       FROM RAGREEMENT JOIN VEHICLE ON (RAGREEMENT.LICENSENO = VEHICLE.LICENSENO)
                       JOIN OUTLET  ON (OUTLET.OUTNO = VEHICLE.OUTNO) 
       WHERE (RETURNDATE >= '01-OCT-2017' AND RETURNDATE <= '31-MAR-2018')
       GROUP BY OUTLET.OUTNO
      );

	  
-----7---------------------------------
----every assumption
SELECT NVL(MAKE,'GRANT TOTAL') MAKE,MODEL, COUNT(LICENSENO) AS NUM_LICENSE, 
    ROUND(SUM(EXTRACT(YEAR FROM SYSDATE)-YEAR)/COUNT(LICENSENO)) AS AVE_AGE,
    COUNT(RENTALNO) AS NUM_RENTAL,
	COUNT (REPORTNUM) AS NUM_REPORTS,
	NVL(CEIL(SUM(TRUNC(NVL(RETURNDATE,SYSDATE))-(CASE WHEN TRUNC(STARTDATE)>TO_DATE('01-JAN-2018','DD=MON-YYYY')
	                                                 THEN TO_DATE('01-JAN-2018','DD=MON-YYYY')
													 ELSE TRUNC(STARTDATE) END))),0) AS RENT_DAYS
FROM VEHICLE LEFT JOIN (SELECT * FROM RAGREEMENT
								     WHERE (NVL(RETURNDATE,SYSDATE) >= TO_DATE('01-JAN-2018')) AND (STARTDATE <=TO_DATE('31-DEC-2018')))
					  USING (LICENSENO)
			LEFT JOIN (SELECT * FROM FAULTREPORT)
					  USING (LICENSENO,RENTALNO)				 
GROUP BY ROLLUP(MAKE,MODEL);

-------8-----	
SELECT DECODE(MAKE,NULL,' ','Q1') AS QUATER,MAKE,
       RANK() OVER (ORDER BY NVL(RATIO,0)DESC) AS RANK,
	   NVL(TOTALNUMRENTAL,0) AS RENTAL_COUNT,
	   NVL(TOTALNUMREPORT,0) AS REPORT_COUNT,
	   NVL(RATIO*100,0) AS "LIKELIHOOD OF FAULT IN %"
FROM (
(SELECT DISTINCT MAKE,
	        COUNT(DISTINCT RENTALNO) AS TOTALNUMRENTAL,
			COUNT(REPORTNUM)  AS TOTALNUMREPORT,
			COUNT(DISTINCT REPORTNUM)/COUNT(REPORTNUM) AS RATIO
	FROM RAGREEMENT RIGHT JOIN VEHICLE USING(LICENSENO)
				    LEFT JOIN FAULTREPORT USING (RENTALNO,LICENSENO)
	WHERE (EXTRACT(MONTH FROM STARTDATE) IN (1,2,3) AND EXTRACT(YEAR FROM STARTDATE) = 2017)
	GROUP BY MAKE)
FULL OUTER JOIN
	(SELECT DISTINCT MAKE
	FROM RAGREEMENT RIGHT JOIN VEHICLE USING(LICENSENO)
				    LEFT JOIN FAULTREPORT USING (RENTALNO,LICENSENO))
	 USING (MAKE))
UNION ALL 
SELECT DECODE(MAKE,NULL,' ','Q2') AS QUATER,MAKE,
       RANK() OVER (ORDER BY NVL(RATIO,0)DESC) AS RANK,
	   NVL(TOTALNUMRENTAL,0) AS RENTAL_COUNT,
	   NVL(TOTALNUMREPORT,0) AS REPORT_COUNT,
	   NVL(RATIO*100,0) AS "LIKELIHOOD OF FAULT IN %"
FROM (
(SELECT DISTINCT MAKE,
	        COUNT(DISTINCT RENTALNO) AS TOTALNUMRENTAL,
			COUNT(REPORTNUM)  AS TOTALNUMREPORT,
			COUNT(DISTINCT REPORTNUM)/COUNT(REPORTNUM) AS RATIO
	FROM RAGREEMENT RIGHT JOIN VEHICLE USING(LICENSENO)
				    LEFT JOIN FAULTREPORT USING (RENTALNO,LICENSENO)
	WHERE (EXTRACT(MONTH FROM STARTDATE) IN (4,5,6) AND EXTRACT(YEAR FROM STARTDATE) = 2017)
	GROUP BY MAKE)
FULL OUTER JOIN
	(SELECT DISTINCT MAKE
	FROM RAGREEMENT RIGHT JOIN VEHICLE USING(LICENSENO)
				    LEFT JOIN FAULTREPORT USING (RENTALNO,LICENSENO))
	 USING (MAKE))
UNION ALL
SELECT DECODE(MAKE,NULL,' ','Q3') AS QUATER,MAKE,
       RANK() OVER (ORDER BY NVL(RATIO,0)DESC) AS RANK,
	   NVL(TOTALNUMRENTAL,0) AS RENTAL_COUNT,
	   NVL(TOTALNUMREPORT,0) AS REPORT_COUNT,
	   NVL(RATIO*100,0) AS "LIKELIHOOD OF FAULT IN %"
FROM (
(SELECT DISTINCT MAKE,
	        COUNT(DISTINCT RENTALNO) AS TOTALNUMRENTAL,
			COUNT(REPORTNUM)  AS TOTALNUMREPORT,
			COUNT(DISTINCT REPORTNUM)/COUNT(REPORTNUM) AS RATIO
	FROM RAGREEMENT RIGHT JOIN VEHICLE USING(LICENSENO)
				    LEFT JOIN FAULTREPORT USING (RENTALNO,LICENSENO)
	WHERE (EXTRACT(MONTH FROM STARTDATE) IN (7,8,9) AND EXTRACT(YEAR FROM STARTDATE) = 2017)
	GROUP BY MAKE)
FULL OUTER JOIN
	(SELECT DISTINCT MAKE
	FROM RAGREEMENT RIGHT JOIN VEHICLE USING(LICENSENO)
				    LEFT JOIN FAULTREPORT USING (RENTALNO,LICENSENO))
	 USING (MAKE))
UNION ALL
SELECT DECODE(MAKE,NULL,' ','Q4') AS QUATER,MAKE,
       RANK() OVER (ORDER BY NVL(RATIO,0)DESC) AS RANK,
	   NVL(TOTALNUMRENTAL,0) AS RENTAL_COUNT,
	   NVL(TOTALNUMREPORT,0) AS REPORT_COUNT,
	   NVL(RATIO*100,0) AS "LIKELIHOOD OF FAULT IN %"
FROM (
(SELECT DISTINCT MAKE,
	        COUNT(DISTINCT RENTALNO) AS TOTALNUMRENTAL,
			COUNT(REPORTNUM)  AS TOTALNUMREPORT,
			COUNT(DISTINCT REPORTNUM)/COUNT(REPORTNUM) AS RATIO
	FROM RAGREEMENT RIGHT JOIN VEHICLE USING(LICENSENO)
				    LEFT JOIN FAULTREPORT USING (RENTALNO,LICENSENO)
	WHERE (EXTRACT(MONTH FROM STARTDATE) IN (10,11,12) AND EXTRACT(YEAR FROM STARTDATE) = 2017)
	GROUP BY MAKE)
FULL OUTER JOIN
	(SELECT DISTINCT MAKE
	FROM RAGREEMENT RIGHT JOIN VEHICLE USING(LICENSENO)
				    LEFT JOIN FAULTREPORT USING (RENTALNO,LICENSENO))
	 USING (MAKE));
---9------
SELECT OUTNO, NVL(CLIENT_NO_SAME_STATE,0), NVL(RENTAL_NO_SAME_STATE,0), NVL(ROUND((CLIENT_NO_SAME_STATE/CLIENTTOTAL),2),0) AS RATIO_CUSTOMER, 
NVL(ROUND((RENTAL_NO_SAME_STATE/RENTALTOTAL),2),0) AS RATIO_FAULTREPORT
FROM
(SELECT OUTNO, COUNT(DISTINCT CLIENTNO) AS CLIENT_NO_SAME_STATE, COUNT(DISTINCT RENTALNO) AS RENTAL_NO_SAME_STATE
FROM OUTLET LEFT JOIN VEHICLE USING(OUTNO)
			LEFT JOIN RAGREEMENT USING (LICENSENO)
			LEFT JOIN CLIENT USING (CLIENTNO)
WHERE OUTLET.STATE=CLIENT.STATE
GROUP BY (OUTNO))
FULL OUTER JOIN
(SELECT OUTNO, COUNT(DISTINCT CLIENTNO) AS CLIENTTOTAL, COUNT(DISTINCT RENTALNO) AS RENTALTOTAL
FROM OUTLET LEFT JOIN VEHICLE USING(OUTNO)
			LEFT JOIN RAGREEMENT USING (LICENSENO)
			LEFT JOIN CLIENT USING (CLIENTNO)
GROUP BY (OUTNO))
USING (OUTNO);



--10FINAL--
COLUMN EMPLOYEE_NAME FORMAT A28
SELECT L AS "LEVEL", "Employee_Name", 
       TABLE1.EMPNO  AS "Employee Number", POSITION AS "Position", 
       OUTNO AS "Outlet", NVL("FaultR",0) AS "Total Reports"
FROM
    (
     SELECT LEVEL AS "L", LPAD(' ', 3*(LEVEL - 1)) || FNAME || ' ' || LNAME "Employee_Name",
            EMPNO, POSITION,
            OUTLET.OUTNO
     FROM EMPLOYEE JOIN OUTLET ON (EMPLOYEE.OUTNO = OUTLET.OUTNO)
     START WITH EMPNO = 1
     CONNECT BY PRIOR EMPNO = SUPERVISORNO
    ) TABLE1
LEFT OUTER JOIN
    (
     SELECT EMPLOYEE.EMPNO, COUNT(REPORTNUM) AS "FaultR"
     FROM EMPLOYEE JOIN FAULTREPORT ON (EMPLOYEE.EMPNO = FAULTREPORT.EMPNO)
     WHERE DATECHECKED > SYSDATE - 90
     GROUP BY(EMPLOYEE.EMPNO)
    ) TABLE2
ON TABLE1.EMPNO = TABLE2.EMPNO;